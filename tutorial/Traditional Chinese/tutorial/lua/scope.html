<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="../../../style.css" rel="stylesheet" type="text/css" media="screen" />
</head>
<body style="padding:13px">
<pre>
<font class="title">區域變數</font>
先寫 local 再寫變數名稱然後賦值就是在建立區域變數了
用 lua 內建的 print 函式可以檢查出該區域變數是否被刪除了
被刪除的變數會使得 print 印出 nil

<div class="code"><span class="sc5">local</span><span class="sc0"> </span><span class="sc11">g</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc0">   </span><span class="sc2">-- 建立區域變數
</span><span class="sc13">print</span><span class="sc10">(</span><span class="sc11">g</span><span class="sc10">)</span><span class="sc0">      </span><span class="sc2">-- 會印出8
</span><span class="sc11">g</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">g</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc0">
</span><span class="sc13">print</span><span class="sc10">(</span><span class="sc11">g</span><span class="sc10">)</span><span class="sc0">      </span><span class="sc2">-- 會印出9
</span><span class="sc11">g</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">nil</span><span class="sc0">       </span><span class="sc2">-- 刪除此變數
</span><span class="sc13">print</span><span class="sc10">(</span><span class="sc11">g</span><span class="sc10">)</span><span class="sc0">      </span><span class="sc2">-- 會印出 nil</span></div>








<font class="title">自動刪除區域變數</font>
區域變數不像<a href="global.html" target="_self">全域變數</a>需要手動刪除
當所屬 scope 結束時
區域變數會自動被刪除(不過你要搶在被自動刪除之前進行手動刪除也沒問題)


下面兩個範例只使用 do 跟 end 這兩個關鍵字來圍出一段 scope

<div class="code"><span class="sc5">local</span><span class="sc0"> </span><span class="sc11">g</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc0">      </span><span class="sc2">-- 下面每一行都讀的到這變數
</span><span class="sc0">
</span><span class="sc2">-- 這裡簡單的用 do end 來產生 scope
</span><span class="sc5">do</span><span class="sc0"></span><span class="sc2">-- scope 開始
</span><span class="sc0">    </span><span class="sc13">print</span><span class="sc10">(</span><span class="sc11">g</span><span class="sc10">)</span><span class="sc0">     </span><span class="sc2">-- 印出8
</span><span class="sc0">    </span><span class="sc13">print</span><span class="sc10">(</span><span class="sc11">x</span><span class="sc10">)</span><span class="sc0">     </span><span class="sc2">-- 印出nil，因為此時 x 不存在
</span><span class="sc0">    </span><span class="sc5">local</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc0">  </span><span class="sc2">-- 建立區域變數 x
</span><span class="sc0">    </span><span class="sc13">print</span><span class="sc10">(</span><span class="sc11">x</span><span class="sc10">)</span><span class="sc0">     </span><span class="sc2">-- 印出4
</span><span class="sc5">end</span><span class="sc0"></span><span class="sc2">-- scope 結束
</span><span class="sc0">
</span><span class="sc13">print</span><span class="sc10">(</span><span class="sc11">g</span><span class="sc10">)</span><span class="sc0">   </span><span class="sc2">-- 印出8
</span><span class="sc13">print</span><span class="sc10">(</span><span class="sc11">x</span><span class="sc10">)</span><span class="sc0">   </span><span class="sc2">-- 印出ni，因為此時 x 已自動刪除了
</span></div>












下面範例已經清楚的告訴你何時遇到 end 會刪除區域變數

<div class="code"><span class="sc5">local</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc0">  </span><span class="sc2">-- 下面每一行都能讀的到 x 這個值
</span><span class="sc0">
</span><span class="sc2">-- 這裡就只能讀到 x 的值，y z 還沒出現
</span><span class="sc13">print</span><span class="sc10">(</span><span class="sc11">x</span><span class="sc10">)</span><span class="sc0">     </span><span class="sc2">-- 印出 1
</span><span class="sc13">print</span><span class="sc10">(</span><span class="sc11">y</span><span class="sc10">)</span><span class="sc0">     </span><span class="sc2">-- 印出 nil
</span><span class="sc13">print</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">)</span><span class="sc0">     </span><span class="sc2">-- 印出 nil
</span><span class="sc0">
</span><span class="sc5">do</span><span class="sc0">
    </span><span class="sc5">local</span><span class="sc0"> </span><span class="sc11">y</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc0">
    </span><span class="sc13">print</span><span class="sc10">(</span><span class="sc11">x</span><span class="sc10">)</span><span class="sc0">     </span><span class="sc2">-- 印出 1
</span><span class="sc0">    </span><span class="sc13">print</span><span class="sc10">(</span><span class="sc11">y</span><span class="sc10">)</span><span class="sc0">     </span><span class="sc2">-- 印出 2，此時 y 也能讀到值了
</span><span class="sc0">    </span><span class="sc13">print</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">)</span><span class="sc0">     </span><span class="sc2">-- 印出 nil
</span><span class="sc0">    </span><span class="sc5">do</span><span class="sc0">
        </span><span class="sc5">local</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc0">
        </span><span class="sc2">-- 此時3個變數都是存在的，3個數字都印的出來
</span><span class="sc0">        </span><span class="sc13">print</span><span class="sc10">(</span><span class="sc11">x</span><span class="sc10">)</span><span class="sc0">     </span><span class="sc2">-- 印出 1
</span><span class="sc0">        </span><span class="sc13">print</span><span class="sc10">(</span><span class="sc11">y</span><span class="sc10">)</span><span class="sc0">     </span><span class="sc2">-- 印出 2
</span><span class="sc0">        </span><span class="sc13">print</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">)</span><span class="sc0">     </span><span class="sc2">-- 印出 3
</span><span class="sc0">    </span><span class="sc5">end</span><span class="sc0"></span><span class="sc2">-- 此時 z 被刪除了
    </span><span class="sc13">print</span><span class="sc10">(</span><span class="sc11">x</span><span class="sc10">)</span><span class="sc0">     </span><span class="sc2">-- 印出 1
</span><span class="sc0">    </span><span class="sc13">print</span><span class="sc10">(</span><span class="sc11">y</span><span class="sc10">)</span><span class="sc0">     </span><span class="sc2">-- 印出 2
</span><span class="sc0">    </span><span class="sc13">print</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">)</span><span class="sc0">     </span><span class="sc2">-- 印出 nil，因為已經自動刪除了
</span><span class="sc5">end</span><span class="sc0"></span><span class="sc2">-- 此時 y 被刪除了
</span><span class="sc0">
</span><span class="sc13">print</span><span class="sc10">(</span><span class="sc11">x</span><span class="sc10">)</span><span class="sc0">     </span><span class="sc2">-- 印出 1
</span><span class="sc13">print</span><span class="sc10">(</span><span class="sc11">y</span><span class="sc10">)</span><span class="sc0">     </span><span class="sc2">-- 印出 nil
</span><span class="sc13">print</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">)</span><span class="sc0">     </span><span class="sc2">-- 印出 nil
</span><span class="sc0">
</span><span class="sc2">-- x 會活到程式碼的最後一行才被刪除
</span></div>

























自己寫程式試一試就能搞懂這個機制了


<font class="title">被刪除的變數</font>
那些變數雖然被刪除了
但是它們未必已經把佔用的記憶體歸還給電腦了
因為 Lua 的做法是會選個時機來一口氣歸還所有記憶體


你可以呼叫這個函式來要求 Lua 立刻進行歸還動作
collectgarbage("collect")


<font class="title">變數離開了 scope 卻還沒被刪除</font>
這在<a href="function.html" target="_self">閉包</a>的情況下的確會發生
因為閉包活了下來
被閉包引用的變數因此沒有消失



</pre>
</body>
</html>
